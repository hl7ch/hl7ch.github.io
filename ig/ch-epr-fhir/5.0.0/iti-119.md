# Patient Demographics Match [ITI-119] - CH EPR FHIR (R4) v5.0.0

* [**Table of Contents**](toc.md)
* **Patient Demographics Match [ITI-119]**

## Patient Demographics Match [ITI-119]

This section describes the national extension for the Swiss EPR to the [Patient Demographics Match [ITI-119]](https://profiles.ihe.net/ITI/PDQm/ITI-119.html) transaction defined in the PDQm profile published in the IHE IT Infrastructure Technical Framework Trial Implementation “Patient Demographics Query for mobile”.

### Scope

The Mobile Patient Demographics Query is used by an app in the Swiss EPR to query with demographics parameters for a patient participating in the Swiss EPR.

### Actor Roles

**Actor:** Patient Demographics Consumer 
 **Role:** Requests a list of patients matching the supplied set of demographics criteria (example: ID or Name) from the Patient Demographics Supplier. The Patient Demographics Consumer populates its attributes with demographic information received from the Patient Demographics Supplier. 
 **Actor:** Patient Demographics Supplier 
 **Role:** Returns demographic information for all patients matching the demographics criteria provided by the Patient Demographics Consumer

### Referenced Standards

1. [Patient Demographics Query for mobile (PDQm) 3.2.0](https://profiles.ihe.net/ITI/PDQm/3.2.0)
1. This PDQm Profile is based on Release 4 of the emerging[HL7® FHIR®](https://hl7.org/fhir/R4/index.html)standard.

### Messages

#### Match Patient Resource Message

##### Message Semantics

The semantics of the **Match Patient Resource** message is the same as defined in [2:3.119.4.1.2](https://profiles.ihe.net/ITI/PDQm/ITI-119.html#23119412-message-semantics), with the following restrictions:

* When specifying the count parameter, no more than 5 matches SHALL be requested.

The HTTP body SHALL conform to the [PDQm Match Input Parameters profile](StructureDefinition-CHPDQmMatchParametersIn.md).

##### Expected Actions

The **Patient Demographics Supplier** shall follow the expected actions as defined in [2:3.119.4.1.3](https://profiles.ihe.net/ITI/PDQm/ITI-119.html#23119413-expected-actions), with the following restrictions:

* If there are more than 5 matches, the result should return zero matches with an OperationOutcome requesting more query parameters.
* If the client requests more than 5 matches, the result should return zero matches with an OperationOutcome explaining the server can't fulfill the request.
* Patient identifiers other than the MPI-PID and EPR-SPID SHALL NOT be returned.

The patient data (see [Patient example](Patient-FranzMusterNeedsAbsoluteUrl.md)) SHALL conform to the [PDQm Patient profile](StructureDefinition-ch-pdqm-patient.md). The **Patient Demographics Supplier** SHALL reference the **PDQm Patient** profile or a derived constrained profile as a `supportedProfile` in the CapabilityStatement.

##### Message Example

Query for a patient with family name Muster and birthdate 1995-01-27.

```
POST [base]/Patient/$match
Content-Type: application/fhir+json
Accept: application/fhir+json
traceparent: 00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-00

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
      "name" : "resource",
      "resource" : {
        "resourceType" : "Patient",
        "name" : [
          {
            "family" : "Muster",
          }
        ],
        "birthDate" : "1995-01-27"
      }
    }
  ]
}

```

[Example response to above query](Bundle-PDQm-QueryResponse.json.md)

Query for a patient with family name M returning too many results:

```
POST [base]/Patient/$match
Content-Type: application/fhir+json
Accept: application/fhir+json
traceparent: 00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-00

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
      "name" : "resource",
      "resource" : {
        "resourceType" : "Patient",
        "name" : [
          {
            "family" : "M",
          }
        ]
      }
    }
  ]
}

```

[Example response to above query](Bundle-PDQm-QueryResponseTooManyResults.json.md)

#### Query Patient Resource Response message

The response Bundle SHALL conform to the [PDQm Match Output Bundle profile](StructureDefinition-ch-pdqm-matchparametersout.md).

#### CapabilityStatement Resource

The CapabilityStatement resource for the **Patient Demographics Consumer** is [PDQm Consumer](CapabilityStatement-CH.PDQm.Consumer.md).

The CapabilityStatement resource for the **Patient Demographics Supplier** is [PDQm Supplier](CapabilityStatement-CH.PDQm.Supplier.md).

### Security Consideration

The transaction SHALL be secured by Transport Layer Security (TLS) encryption and server authentication with server certificates.

The transaction SHALL use client authentication and authorization using one of the following strategies:

1. Use a basic access token defined in[IUA](iti-71.md)conveyed as defined in the[Incorporate Access Token [ITI-72]](https://profiles.ihe.net/ITI/IUA/index.html#372-incorporate-access-token-iti-72)transaction.
1. or, use mutual authentication (mTLS) on the transport layer.

The actors SHALL support the **traceparent** header handling, as defined in [Appendix: Trace Context](tracecontext.md).

#### Security Audit Considerations

##### Patient Demographics Consumer Audit

The **Patient Demographics Consumer** SHALL record an audit event according to [CH Audit Event for [ITI-119] Patient Demographics Consumer](StructureDefinition-ChAuditEventIti119Consumer.md) ([example](AuditEvent-ChAuditEventIti119ConsumerExample.md)).

##### Patient Demographics Supplier Audit

The **Patient Demographics Supplier** SHALL record an audit event according to [CH Audit Event for [ITI-119] Patient Demographics Supplier](StructureDefinition-ChAuditEventIti119Supplier.md) ([example](AuditEvent-ChAuditEventIti119SupplierExample.md)).

