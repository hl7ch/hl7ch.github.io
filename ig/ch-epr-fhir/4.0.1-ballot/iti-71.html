<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Get Access Token [ITI-71] - CH EPR FHIR (R4) v4.0.1-ballot</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
    <link href="assets/css/hl7.css" rel="stylesheet"/>
    <link href="assets/css/fhir.css" rel="stylesheet"/>

    <style>
    
    .navbar-inverse {
        background-color: #144b8a;
    }   

    #segment-footer .container {
      background-color: #144b8a;
    }
    

    

    
    #ig-status {
      color: #4fa2da;
    } 
    

    </style>
 

    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3.1"}
    h3,h4,h5,h6{--heading-prefix:"3.1"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

            <!--
<div id="family-nav">
	<a id="logo" no-external="true" href="http://hl7.org/fhir"> <img
		alt="logo fhir" src="assets/images/fhir-logo-www.png" />
	</a>
</div>
-->


            <div id="family-nav">
                <a id="logo" no-external="true" href="searchform.html">
                    <img src="assets/images/search.png" alt="Search FHIR" />
                </a>
            </div>
            <div id="hl7-nav">
    <a id="ehealthsuisse-logo" no-external="true" href="https://www.e-health-suisse.ch">
        <img alt="visit the e-health-suisse website" height="60" src="assets/images/LogoDE_ehealthsuisse.svg" />
    </a>            
</div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">CH EPR FHIR (R4)</span>
            <br/>
            <span style="display:inline-block;">4.0.1-ballot - ballot



  <img alt="Switzerland flag" src="assets/images/che.svg" height="16" title="Switzerland"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
    <li>
        <a href="index.html">Home</a>
    </li>
    <li class="Profiles">
        <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 1
            <b class="caret">
            </b>
        </a>
        <ul class="dropdown-menu">
            <li>
                <a href="iti-iua.html">Internet User Authorization (IUA)</a>
            </li>
            <li>
                <a href="iti-pdqm.html">Patient Demographics Query for mobile (PDQm)</a>
            </li>
            <li>
                <a href="iti-pixm.html">Patient Identifier Cross-referencing for mobile (PIXm)</a>
            </li>
            <li>
                <a href="iti-mhd.html">Mobile Access to Health Documents (MHD) with XDS on FHIR</a>
            </li>
            <li>
                <a href="iti-restful-atna.html">RESTful ATNA</a>
            </li>
            <li>
                <a href="iti-mcsd.html">Mobile Care Services Discovery (mCSD)</a>
            </li>
            <li>
                <a href="ppqm.html">Privacy Policy Query for Mobile (CH:PPQm)</a>
            </li>
        </ul>
    </li>
    <li class="dropdown">
        <a data-toggle="dropdown" href="#" class="dropdown-toggle">Volume 2
            <b class="caret">
            </b>
        </a>
        <ul class="dropdown-menu">
            <li>
                <a href="iti-103.html">Get Authorization Server Metadata [ITI-103]</a>
            </li>
            <li>
                <a href="iti-71.html">Get Access Token [ITI-71]</a>
            </li>
            <li>
                <a href="iti-104.html">Patient Identity Feed FHIR [ITI-104]</a>
            </li>
            <li>
                <a href="iti-78.html">Mobile Patient Demographics Query [ITI-78]</a>
            </li>
            <li>
                <a href="iti-83.html">Mobile Patient Identifier Cross-reference Query [ITI-83]</a>
            </li>
            <li>
                <a href="iti-65.html">Provide Document Bundle [ITI-65]</a>
            </li>
            <li>
                <a href="iti-66.html">Find Document Lists [ITI-66]</a>
            </li>
            <li>
                <a href="iti-67.html">Find Document References [ITI-67]</a>
            </li>
            <li>
                <a href="iti-68.html">Retrieve Document [ITI-68]</a>
            </li>
            <li>
                <a href="ch-mhd-1.html">Update Document Metadata [CH:MHD-1]</a>
            </li>
            <li>
                <a href="iti-20.html">Record Audit Event [ITI-20]</a>
            </li>
            <li>
                <a href="iti-90.html">Find Matching Care Services [ITI-90]</a>
            </li>
            <li>
                <a href="ppq-3.html">Mobile Privacy Policy Feed [PPQ-3]</a>
            </li>
            <li>
                <a href="ppq-4.html">Mobile Privacy Policy Bundle Feed [PPQ-4]</a>
            </li>
            <li>
                <a href="ppq-5.html">Mobile Privacy Policy Retrieve [PPQ-5]</a>
            </li>
        </ul>
    </li>
    <li class="dropdown">
        <a data-toggle="dropdown" href="#" class="dropdown-toggle">Appendix
            <b class="caret">
            </b>
        </a>
        <ul class="dropdown-menu">
            <li>
                <a href="profiles.html">Profiles</a>
            </li>
            <li>
                <a href="extensions.html">Extensions</a>
            </li>
            <li>
                <a href="terminology.html">Terminology</a>
            </li>
            <li>
                <a href="capstatements.html">Capability Statements</a>
            </li>
            <li>
                <a href="operations.html">Operations</a>
            </li>
            <li>
                <a href="sequencediagrams.html">Sequence diagrams</a>
            </li>
            <li>
                <a href="tracecontext.html">Trace Context</a>
            </li>
            <li>
                <a href="changelog.html">Open Issues / Change Log</a>
            </li>
        </ul>
    </li>
    <li>
        <a href="artifacts.html">Artifacts</a>
    </li>
</ul>

            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><a href='volume2.html'><b>Volume 2</b></a></li><li><b>Get Access Token [ITI-71]</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the CH EPR FHIR (R4) (v4.0.1-ballot: <a data-no-external="true" href="https://confluence.hl7.org/display/HL7/HL7+Balloting" title="Draft Standard for Trial-Use">DSTU</a> 4 Ballot 2) based on <a data-no-external="true" href="http://hl7.org/fhir/R4">FHIR (HL7® FHIR® Standard) R4</a>. The current version which supersedes this version is <a data-no-external="true" href="http://fhir.ch/ig/ch-epr-fhir">5.0.0</a>.  For a full list of available versions, see the <a data-no-external="true" href="http://fhir.ch/ig/ch-epr-fhir/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Get Access Token [ITI-71]</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#scope" id="markdown-toc-scope">Scope</a></li>
  <li><a href="#actor-roles" id="markdown-toc-actor-roles">Actor Roles</a></li>
  <li><a href="#referenced-standards" id="markdown-toc-referenced-standards">Referenced Standards</a></li>
  <li><a href="#messages" id="markdown-toc-messages">Messages</a></li>
  <li><a href="#security-consideration" id="markdown-toc-security-consideration">Security Consideration</a></li>
</ul>

</div>
<p>This section describes the national extension for the Swiss EPR to the <a href="https://profiles.ihe.net/ITI/IUA/index.html#371-get-access-token-iti-71">Get Access Token
[ITI-71]</a> transaction defined in the IUA 
profile published in the IHE IT Infrastructure Technical Framework Trial Implementation “Internet User 
Authorization”. In this transaction, the OAuth Authorization Code grant type option is enforced for security reasons.</p>

<h3 id="scope">Scope</h3>

<p>The transaction is used by an IUA Authorization Client (e.g., portals and primary systems) to pass claims to the IUA Authorization Server and to retrieve an access token to be used for authorization of the access to protected resources of the Swiss EPR.</p>

<p>Depending on the claims made by the IUA Authorization Client, two different flavors of access tokens SHALL be provided by the IUA Authorization Server:</p>

<ul>
  <li>Basic Access Token – IUA compliant access token authorizing access to the EPR end-points which are NOT protected by the EPR role and attribute based authorization (i.e. for the PIXm endpoints).</li>
  <li>Extended Access Token – IUA compliant access token for the EPR endpoints which are protected by the EPR role and attribute based authorization (i.e. for the MHD endpoints).</li>
</ul>

<p>When an IUA Authorization Client is authorized, it may launch SMART on FHIR Apps using the EHR launch by claiming a launch indicator. When launched the SMART on FHIR Apps inherit the basic access authorization from the launching app and may retrieve Extended Access Token for EPR endpoints protected by the EPR role and attribute based authorization (e.g. to retrieve documents).</p>

<h3 id="actor-roles">Actor Roles</h3>

<p><strong>Actor:</strong> IUA Authorization Client<br />
<strong>Role:</strong> Communicates claims and launch information to the IUA Authorization Server and receives JWT access token. <br />
<strong>Actor:</strong> IUA Authorization Server<br />
<strong>Role:</strong> Identifies the Authorization Client, authorizes the access on behalf of the user, verifies claims, optionally authenticates the user and responds a JWT Access Token to the IUA Authorization Client to be incorporated into the transactions to access protected resources.</p>

<h3 id="referenced-standards">Referenced Standards</h3>

<ol>
  <li><a href="https://profiles.ihe.net/ITI/IUA/index.html">IHE ITI Technical Framework Supplement Internet User Authorization (IUA) Revision 2.2</a></li>
  <li><a href="http://www.hl7.org/fhir/smart-app-launch/">SMART Application Launch Framework Implementation Guide Release 2.1.0</a></li>
</ol>

<h3 id="messages">Messages</h3>

<h4 id="client-credential-grant-type">Client Credential Grant Type</h4>

<p>This section specifies the OAuth 2.1 client credential grant flow of the IUA Get Access Token transaction, which shall be used by clinical archive systems to retrieve an Access Token.</p>

<div><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="187px" preserveAspectRatio="none" style="width:502px;height:187px;background:#FFFFFF;" version="1.1" viewBox="0 0 502 187" width="502px" zoomAndPan="magnify"><defs /><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="243" x="128.75" y="27.9951">Interaction Diagram for [ITI-71]</text><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="74" y="133.8594" /><rect fill="#FFFFFF" height="38.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="415" y="104.7266" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="79" x2="79" y1="73.5938" y2="151.8594" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="419.5" x2="419.5" y1="73.5938" y2="151.8594" /><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="5" y="42.2969" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="12" y="62.292">Authorization Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="5" y="150.8594" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="12" y="170.8545">Authorization Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="343.5" y="42.2969" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="350.5" y="62.292">Authorization Server</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="343.5" y="150.8594" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="350.5" y="170.8545">Authorization Server</text><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="74" y="133.8594" /><rect fill="#FFFFFF" height="38.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="415" y="104.7266" /><polygon fill="#181818" points="403,100.7266,413,104.7266,403,108.7266,407,104.7266" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="79" x2="409" y1="104.7266" y2="104.7266" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="86" y="99.6606">[00]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="120" y="99.6606">Get Access Token Request</text><polygon fill="#181818" points="95,129.8594,85,133.8594,95,137.8594,91,133.8594" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="89" x2="414" y1="133.8594" y2="133.8594" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="101" y="128.7935">[01]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="135" y="128.7935">Get Access Token Response (access token)</text></g></svg></div>
<figcaption id="10">Sequence diagram of the transaction.</figcaption>

<table class="table table-bordered">

  <colgroup>
   <col span="1" style="width: 5%;" />
   <col span="1" style="width: 25%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 25%;" />
</colgroup>

  <thead>
   <tr>
    <th>Step</th>
    <th>Action</th>
    <th>Parameter</th>
    <th>Opt (Basic/ Extended).</th>
    <th>Reference</th>
    <th>Remark</th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td>00</td>
    <td>The Authorization Client sends an HTTP POST request to the IUA Authorization Server endpoint.</td>
    <td>response_type</td>
    <td>R</td>
    <td>IUA</td>
    <td>The value SHALL be client_credentials.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>client_id</td>
    <td>R</td>
    <td>IUA</td>
    <td>The ID, the Authorization Client is registered at the IUA Authorization Server.
    </td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>client_secret</td>
    <td>R</td>
    <td>IUA</td>
    <td>An unguessable value registered for the Authorization Client during onboarding.
    </td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>scope</td>
    <td>R</td>
    <td>IUA</td>
    <td>Attributes the Authorization Client claims (see detailed description below).</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>aud</td>
    <td>R</td>
    <td>SMART on FHIR</td>
    <td>The URL or array of URL of the Resource Servers the token is intended to be used for.</td>
   </tr>
   <tr>
    <td>01</td>
    <td>The Authorization Server responds with the access token in the HTML body element.</td>
    <td>access_token</td>
    <td>R</td>
    <td>IUA</td>
    <td>A string containing the access token which SHALL be a JWT token.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>token_type</td>
    <td>R</td>
    <td>IUA</td>
    <td>The value of the parameter shall be Bearer.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>scope</td>
    <td>R</td>
    <td>IUA</td>
    <td>The scope granted by the Authorization Server.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>expires_in</td>
    <td>R</td>
    <td>IUA</td>
    <td>Maximum duration of 5 minutes.</td>
   </tr>
  </tbody>
 </table>

<figcaption id="11">Description of the HTTP conversation of the transaction.</figcaption>

<h4 id="authorization-code-grant-type">Authorization Code Grant Type</h4>

<p>This section specifies the OAuth 2.1 authorization code grant flow of the IUA Get Access Token transaction, which shall be used by portals and primary systems.</p>

<div><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="513px" preserveAspectRatio="none" style="width:1012px;height:513px;background:#FFFFFF;" version="1.1" viewBox="0 0 1012 513" width="1012px" zoomAndPan="magnify"><defs /><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="243" x="391" y="27.9951">Interaction Diagram for [ITI-71]</text><rect fill="#FFFFFF" height="235.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="134.5" y="188.9922" /><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="139.5" y="312.6563" /><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="578.5" y="341.7891" /><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="583.5" y="415.1875" /><rect fill="#FFFFFF" height="206.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="924.5" y="218.125" /><rect fill="#FFFFFF" height="38.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="929.5" y="386.0547" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="65" x2="65" y1="118.5938" y2="433.1875" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="139" x2="139" y1="118.5938" y2="433.1875" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="583.5" x2="583.5" y1="118.5938" y2="433.1875" /><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="929" x2="929" y1="118.5938" y2="433.1875" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="46" y="115.292">User</text><ellipse cx="65" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;" /><path d="M65,58.7969 L65,85.7969 M52,66.7969 L78,66.7969 M65,85.7969 L52,100.7969 M65,85.7969 L78,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="46" y="445.1826">User</text><ellipse cx="65" cy="456.9844" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;" /><path d="M65,464.9844 L65,491.9844 M52,472.9844 L78,472.9844 M65,491.9844 L52,506.9844 M65,491.9844 L78,506.9844 " fill="none" style="stroke:#181818;stroke-width:0.5;" /><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="94" y="87.2969" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="101" y="107.292">User Agent</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="94" y="432.1875" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="101" y="452.1826">User Agent</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="509.5" y="87.2969" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="516.5" y="107.292">Authorization Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="509.5" y="432.1875" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="516.5" y="452.1826">Authorization Client</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="853" y="87.2969" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="860" y="107.292">Authorization Server</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="853" y="432.1875" /><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="860" y="452.1826">Authorization Server</text><rect fill="#FFFFFF" height="235.1953" style="stroke:#181818;stroke-width:1.0;" width="10" x="134.5" y="188.9922" /><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="139.5" y="312.6563" /><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="578.5" y="341.7891" /><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="583.5" y="415.1875" /><rect fill="#FFFFFF" height="206.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="924.5" y="218.125" /><rect fill="#FFFFFF" height="38.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="929.5" y="386.0547" /><polygon fill="#181818" points="155.5,184.9922,145.5,188.9922,155.5,192.9922,151.5,188.9922" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="149.5" x2="582.5" y1="188.9922" y2="188.9922" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="161.5" y="176.3599">[00]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="195.5" y="168.7935">Redirect to Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="195.5" y="183.9263">(authorization request incl requested scopes, resource, etc.)</text><polygon fill="#181818" points="912.5,214.125,922.5,218.125,912.5,222.125,916.5,218.125" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="918.5" y1="218.125" y2="218.125" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="151.5" y="213.0591">[01]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="185.5" y="213.0591">authorization request</text><path d="M19,231.125 L19,271.125 L974,271.125 L974,241.125 L964,231.125 L19,231.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;" /><path d="M964,231.125 L964,241.125 L974,241.125 L964,231.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="331.5" y="248.1919">Authorization Server determines access based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="331.5" y="263.3247">user authentication, consent and/or other policies.</text><polygon fill="#181818" points="160.5,308.6563,150.5,312.6563,160.5,316.6563,156.5,312.6563" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="154.5" x2="923.5" y1="312.6563" y2="312.6563" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="166.5" y="300.0239">[02]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="200.5" y="292.4575">Redirect to Client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="200.5" y="307.5903">(authorization response with Authorization Code)</text><polygon fill="#181818" points="566.5,337.7891,576.5,341.7891,566.5,345.7891,570.5,341.7891" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="149.5" x2="572.5" y1="341.7891" y2="341.7891" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="156.5" y="336.7231">[03]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="190.5" y="336.7231">authorization response</text><polygon fill="#181818" points="917.5,382.0547,927.5,386.0547,917.5,390.0547,921.5,386.0547" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="588.5" x2="923.5" y1="386.0547" y2="386.0547" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="595.5" y="373.4224">[04]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="629.5" y="365.856">Get Access Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="629.5" y="380.9888">(client credentials + Authorization Code)</text><polygon fill="#181818" points="604.5,411.1875,594.5,415.1875,604.5,419.1875,600.5,415.1875" style="stroke:#181818;stroke-width:1.0;" /><line style="stroke:#181818;stroke-width:1.0;" x1="598.5" x2="928.5" y1="415.1875" y2="415.1875" /><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="610.5" y="410.1216">[05]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="644.5" y="410.1216">Get Access Token Response (access token)</text></g></svg></div>
<figcaption id="1">Sequence diagram of the transaction.</figcaption>

<table class="table table-bordered">

  <colgroup>
   <col span="1" style="width: 5%;" />
   <col span="1" style="width: 25%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 15%;" />
   <col span="1" style="width: 25%;" />
</colgroup>

  <thead>
   <tr>
    <th>Step</th>
    <th>Action</th>
    <th>Parameter</th>
    <th>Opt (Basic/ Extended).</th>
    <th>Reference</th>
    <th>Remark</th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td>00, 01</td>
    <td>The Authorization Client sends an HTTP GET request to the IUA Authorization Server endpoint.</td>
    <td>response_type</td>
    <td>R</td>
    <td>IUA</td>
    <td>The value SHALL be code.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>client_id</td>
    <td>R</td>
    <td>IUA</td>
    <td>The ID, the Authorization Client is registered at the IUA Authorization Server<sup><a href="#2">2</a></sup>.
    </td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>redirect_uri</td>
    <td>R</td>
    <td>IUA / SMART on FHIR</td>
    <td>Used as the callback URL the IUA Authorization Server will send the authorization code to. The URL SHALL match
     one of the client’s pre-registered redirect URIs.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>state</td>
    <td>R</td>
    <td>IUA</td>
    <td>An unguessable value used by the Authorization Client to track the state between the authorization request and
     the callback.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>scope</td>
    <td>R</td>
    <td>IUA / SMART on FHIR</td>
    <td>Attributes the Authorization Client claims (see detailed description below).</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>aud</td>
    <td>R</td>
    <td>SMART on FHIR</td>
    <td>The URL or array of URL of the Resource Servers the token is intended to be used for.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>launch</td>
    <td>R</td>
    <td>SMART on FHIR</td>
    <td>An opaque identifier which indicates that a SMART on FHIR App was launched from a portal or primary system which
     is authorized to access the Swiss EPR as EHR launch.</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>code_challenge</td>
    <td>R</td>
    <td>IUA</td>
    <td>Transformed version of code_verifier with code_challenge_method</td>
   </tr>
   <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>code_challenge_method</td>
    <td>R</td>
    <td>IUA</td>
    <td>SHALL be “S256”.</td>
   </tr>
   <tr>
    <td>02, 03</td>
    <td>The Authorization Server performs an HTTP GET on the Authorization Client callback URL (redirect_uri) conveying
     the authorization code.</td>
    <td>code</td>
    <td>R</td>
    <td>IUA</td>
    <td>The authorization code generated by the Authorization Server.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>state</td>
    <td>R</td>
    <td>IUA</td>
    <td>The unguessable value used by the Authorization Client to track the state between the authorization request and
     the callback.</td>
   </tr>
   <tr>
    <td>04</td>
    <td>The Authorization Client performs an HTTP POST with parameter as a form-encoded HTTP entity body, passing its
     client_id and client_secret as an HTTP authorization header field.</td>
    <td>client_id</td>
    <td>R</td>
    <td>IUA</td>
    <td>The ID the Authorization Client is registered at the IUA Authorization Server<sup><a href="#2">2</a></sup>.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>grant_type</td>
    <td>R</td>
    <td>IUA</td>
    <td>Value shall be “authorization_code”.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>code</td>
    <td>R</td>
    <td>IUA</td>
    <td>The authorization</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>code_verifier</td>
    <td>R</td>
    <td>IUA</td>
    <td>The original code verifier string.</td>
   </tr>
   <tr>
    <td>05</td>
    <td>The Authorization Server responds with the access token in the HTML body element.</td>
    <td>access_token</td>
    <td>R</td>
    <td>IUA</td>
    <td>A string containing the access token which SHALL be a JWT token.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>token_type</td>
    <td>R</td>
    <td>IUA</td>
    <td>The value of the parameter shall be Bearer.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>scope</td>
    <td>R</td>
    <td>IUA</td>
    <td>The scope granted by the Authorization Server.</td>
   </tr>
   <tr>
    <td>&nbsp;</td> 
    <td>&nbsp;</td>
    <td>expires_in</td>
    <td>R</td>
    <td>IUA</td>
    <td>Maximum duration of 5 minutes.</td>
   </tr>
  </tbody>
 </table>

<figcaption id="5">Description of the HTTP conversation of the transaction.</figcaption>

<p><sup id="2">2</sup>For SMART on FHIR Apps launched in EHR mode the client_id SHALL be the ID of the portal or primary system which launched the App.</p>

<h4 id="get-access-token-request">Get Access Token Request</h4>

<h4 id="client-credential-grant-type-1">Client Credential Grant Type</h4>

<h5 id="trigger-events">Trigger Events</h5>

<p>A clinical archive system aims to access the EPR to write documents.</p>

<h6 id="message-semantics">Message Semantics</h6>

<p>The Authorization Client SHALL send an IUA compliant Authorization Request for the client credential flow. The Authorization Request SHALL set the scope parameter with one or many scope values as defined in the table below.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Scope</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>Type</th>
      <th>Reference</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>purpose_of_use</td>
      <td>R/R</td>
      <td>token<sup><a href="#3">3</a></sup></td>
      <td>See sections below.</td>
      <td>Shall be AUTO as defined in the code system 2.16.756.5.30.1.127.3.10.5 of the CH: EPR value set.</td>
    </tr>
    <tr>
      <td>subject_role</td>
      <td>R/R</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>Shall be the value TCU as defined in the code system 2.16.756.5.30.1.127.3.10.1.1.3 of the CH: EPR value set.</td>
    </tr>
    <tr>
      <td>person_id</td>
      <td>O/R</td>
      <td>string, CX</td>
      <td>See sections below.</td>
      <td>EPR-SPID identifier of the patient’s record and the patient assigning authority formatted in CX syntax.</td>
    </tr>
    <tr>
      <td>principal</td>
      <td>R/R</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>Name of the legal responsible healthcare professional the technical user is acting on behalf of. According to the law and regulations the healthcare professional shall be the individual who is resposiblethe rules to be used by the clinial archive to filter documents to be uploaded to the Swiss EHR.</td>
    </tr>
    <tr>
      <td>principal_id</td>
      <td>R/R</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>GLN of the legal responsible healthcare professional the technical user is acting on behalf of. According to the law and regulations the healthcare professional shall be the individual who is resposible for the rules to be used by the clinial archive to filter documents to be uploaded to the Swiss EHR.</td>
    </tr>
    <tr>
      <td>access_token_format</td>
      <td>O/O</td>
      <td>Strings</td>
      <td> </td>
      <td>SHALL be of value “urn:ietf:params:oauth:token-type:jwt”.</td>
    </tr>
  </tbody>
</table>

<p><sup id="3">3</sup>Token format according FHIR <a href="https://www.hl7.org/fhir/search.html#token">token type</a>.</p>

<figcaption id="16">Request’s scope parameter for the client credential flow.</figcaption>

<h6 id="expected-actions">Expected Actions</h6>

<p>When receiving a Get Access Token Request with purpose of use set to AUTO and subject role set to TCU, the Authorization Server SHALL identify and authenticate the Authorization Client with the client_id, client_secret and the client’s certificate of the TLS connection.</p>

<p>The Authorization Server SHALL verify that the Authorization Client was registered during onboading with the same client_id, client_secret and the client’s certificate of the TLS connection and is authorized to access the EHR.</p>

<p>The Authorization Server SHALL verify that the principal_id matches the GLN of the legal responsible healthcare professional the Authorization Client was registered during onboading.</p>

<p>The Authorization Server SHALL respond with the Get Access Token response as defined in <a href="#get-access-token-response">Get Access Token Response</a> only if all checks are successful. If one of the above checks fails, the Authorization Server SHALL respond with HTTP 401 (Unauthorized) error.</p>

<p>The Authorization Server SHALL respond with a Extended Access Token, only if the person_id is set in the request. The Authorization Server SHALL respond with a Basic Access Token, if the person_id is not set.</p>

<p>The Authorization Client SHALL use the access token as defined in IUA Incorporate Access Token transaction, when performing requests to resources of the Swiss EPR.</p>

<h6 id="message-example">Message Example</h6>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST /token HTTP/1.1 
Host: localhost:9001

Accept: application/json
Content-type: application/x-www-form-urlencoded
Authorization: Basic bXktYXBwOm15LWFwcC1zZWNyZXQtMTIz
grant_type=client_credentials&amp;
access_token_format=urn:ietf:params:oauth:token-type:jwt&amp;
scope=user%2F*.*+openid+fhirUser+purpose_of_use%3Durn%3Aoid%3A2.16.756.5.30.1.127.3.10.5%7CAUTO+subject_role%3Durn%3Aoid%3A2.16.756.5.30.1.127.3.10.6%7CTCU+person_id%3D761337610411353650%5E%5E%5E%262.16.756.5.30.1.109.6.5.3.1.1%26ISO
</span></code></pre></div></div>

<h4 id="authorization-code-grant-type-1">Authorization Code Grant Type</h4>

<h6 id="trigger-events-1">Trigger Events</h6>

<p>A user launches a portal or primary system, or a SMART on FHIR App to access data and documents from the Swiss EPR.</p>

<h6 id="message-semantics-1">Message Semantics</h6>

<p>The Authorization Client SHALL send an IUA compliant Authorization Request for the authorization code flow. The Authorization Request SHALL set the scope parameter with one or many scope values as defined in the table below.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Scope</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>Type</th>
      <th>Reference</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>launch</td>
      <td>O/R</td>
      <td> </td>
      <td>SMART on FHIR</td>
      <td>The opaque identifier the SMART on FHIR App was launched with in an EHR launch. The claim is required for SMART on FHIR Apps launched from an portal or primary system.</td>
    </tr>
    <tr>
      <td>purpose_of_use</td>
      <td>O/R</td>
      <td>token<sup><a href="#3">3</a></sup></td>
      <td>See sections below.</td>
      <td>Value taken from code system 2.16.756.5.30.1.127.3.10.5 of the CH: EPR value set.</td>
    </tr>
    <tr>
      <td>subject_role</td>
      <td>O/R</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>One of the values for Healthcare Professionals, Assistants, Patients and Representatives as defined in the code system 2.16.756.5.30.1.127.3.10.1.1.3 of the CH: EPR value set.</td>
    </tr>
    <tr>
      <td>person_id</td>
      <td>O/R</td>
      <td>string, CX</td>
      <td>See sections below.</td>
      <td>EPR-SPID identifier of the patient’s record and the patient assigning authority formatted in CX syntax.</td>
    </tr>
    <tr>
      <td>principal</td>
      <td>O/O</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>Name of the healthcare professional an assistant is acting on behalf of.</td>
    </tr>
    <tr>
      <td>principal_id</td>
      <td>O/O</td>
      <td>token</td>
      <td>See sections below.</td>
      <td>GLN of the healthcare professional an assistant is acting on behalf of.</td>
    </tr>
    <tr>
      <td>group</td>
      <td>O/O</td>
      <td>string</td>
      <td>See sections below.</td>
      <td>Name of the organization or group an assistant is acting on behalf of.</td>
    </tr>
    <tr>
      <td>group_id</td>
      <td>O/O</td>
      <td>string</td>
      <td>See sections below.</td>
      <td>OID of the organization or group an assistant is acting on behalf of.</td>
    </tr>
    <tr>
      <td>access_token_format</td>
      <td>O/O</td>
      <td>Strings</td>
      <td> </td>
      <td>SHALL be of value “urn:ietf:params:oauth:token-type:jwt”.</td>
    </tr>
  </tbody>
</table>

<p><sup id="3">3</sup>Token format according FHIR <a href="https://www.hl7.org/fhir/search.html#token">token type</a>.</p>

<figcaption id="6">Overview of the request’s scope parameter for the authorization code flow.</figcaption>

<p>The scope parameter of the request MAY claim the following attributes:</p>
<ul>
  <li>There MAY be a scope with name “launch”. If present, it indicates the permission of SMART on FHIR Apps to obtain launch context from a portal or primary system authorized to access the EPR.</li>
  <li>There MAY be a scope with name “purpose_of_use=token”. If present, the token SHALL convey the coded value of the current transaction’s purpose of use. Allowed values are NORM (normal access) and EMER (emergency access) from code system 2.16.756.5.30.1.127.3.10.5 of the CH:EPR value set. e.g. purpose_of_use=urn:oid:2.16.756.5.30.1.127.3.10.5|NORM</li>
  <li>There MAY be a scope with name “subject_role=token”. If present, the token SHALL convey the coded value of the subject’s role. The value SHALL be either HCP (healthcare professional), ASS (assistant), REP (representative) or PAT (patient) from code system 2.16.756.5.30.1.127.3.10.6 of the CH:EPR value set. e.g.: subject_role=urn:oid:2.16.756.5.30.1.127.3.10.6|HCP</li>
  <li>There MAY be a scope with name “person_id=value”. If present, the value SHALL convey the EPR-SPID identifier of the patient’s record and the patient assigning authority formatted in CX syntax. e.g: person_id=761337610411353650^^^&amp;2.16.756.5.30.1.109.6.5.3.1.1&amp;ISO</li>
</ul>

<p>Note: The parameters need to be url encoded, see above message example.</p>

<p>Depending on the value of the role scope additional scopes are required, as described in the following sections.</p>

<p><strong>Healthcare Professional Extension</strong></p>

<p>In the healthcare professional extension, the scope subject_role SHALL be the code HCP from code system 2.16.756.5.30.1.127.3.10.6 of the CH:EPR value set.</p>

<p><strong>Assistant Extension</strong></p>

<p>In the assistant extension, the scope subject_role SHALL be the code ASS from code system 2.16.756.5.30.1.127.3.10.6 of the CH:EPR value set. There SHALL be a scope with name principal_id=value. The value SHALL convey the GLN of the healthcare professional an assistant is acting on behalf of. There SHALL be a scope with name principal=value. The value SHALL convey the name of the healthcare professional an assistant is acting on behalf of.</p>

<p>There MAY be one or more scopes with name group_id=value and corresponding group=value. If present each value SHALL convey the ID and name of the subject’s organization or group as registered in the EPR HPD. The ID SHALL be an OID in the format of a URN.</p>

<p><strong>Patient Extension</strong></p>

<p>In the patient extension, the scope subject_role SHALL be the code PAT from code system 2.16.756.5.30.1.127.3.10.6 of the CH:EPR value set. The value of the purpose of use scope SHALL be the code NORM from code system 2.16.756.5.30.1.127.3.10.5 of the CH:EPR value set.</p>

<p><strong>Representative Extension</strong></p>

<p>In the representative extension, the scope subject_role SHALL be the code REP from code system 2.16.756.5.30.1.127.3.10.6 of the CH:EPR value set. The token of the purpose_of_use scope SHALL be the code NORM from code system 2.16.756.5.30.1.127.3.10.5 of the CH:EPR value set.</p>

<h6 id="expected-actions-1">Expected Actions</h6>

<p>The IUA Authorization Client SHALL support the HTTP conversation of the OAuth 2.1 Authorization Code grant.</p>

<p>When launched, the IUA Authorization Client SHALL perform HTTP GET request with the URL query parameter as defined in <a href="#5">Table</a> and with the scope claims described in <a href="#6">Table</a>.</p>

<p>When receiving the request the Authorization Server, the Authorization Server SHALL verify that the Authorization Client was registered during onboading with the same client_id and the client certificate of the TLS connection.</p>

<p>The Authorization Server SHALL authorize the Authorization Client to access the EHR by either verifying that the Authorization Client request is authorized by a policy or by presenting a form to the user to consent to the access by the Authorization Client on behalf of the user. The Authorization Server MAY cache the users decision for for future access by the same Authorization Client.</p>

<p>The Authorization Server SHALL enforce that the user is authenticated compliant to the regulations of the Swiss EHR and has a valid browser session with an certified Identity Provider. If the user is not authenticated the Authorization Server SHALL respond with an error page or redirect the user to a Identity Provider.</p>

<p>If the IUA Authorization Client receives the request from the IUA Authorization Server on the callback URL conveying the authorization code, the Authorization Client SHALL perform the HTTP POST request with the client_id and client_secret in the HTTP authorization header field to resolve the authorization code to the access token.</p>

<p>The Authorization Server SHALL respond with the Get Access Token response as defined in <a href="#get-access-token-response">Get Access Token Response</a> only if all checks are successful. If one of the above checks fails, the Authorization Server SHALL respond with HTTP 401 (Unauthorized) error.</p>

<p>The IUA Authorization Client SHALL use the access token as defined in IUA Incorporate Access Token transaction, when performing requests to resources of the Swiss EPR.</p>

<h6 id="message-example-1">Message Example</h6>

<p>The first step of the conversation is an HTTP GET which may look like for a Basic Access Token:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET authorize?
    response_type=code&amp;
    client_id=app-client-id&amp;
    redirect_uri=http%3A%2F%2Flocalhost%3A9000%2Fcallback&amp;
    launch=xyz123&amp;
    scope=launch+user%2F%2A.%2A+openid+fhirUser&amp;
    state=98wrghuwuogerg97&amp;
    aud=https%3A%2F%2Fehr%2Ffhir&amp;
    code_challenge=ZmVjMmIwMWYyYTNjZWJiNTgyNTgxYzlmOGYyMWM0MWI3YmZhMjQ4YjU5MDc3Mzk4MDBmYTk0OThlNzZiNjAwMw&amp;
    code_challenge_method=S256
</span></code></pre></div></div>

<p>An extended access token where at least purpose_of_use (NORM), subject_role (HCP) and person_id are added to the scope may look like:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET authorize?
    response_type=code&amp;
    client_id=app-client-id&amp;
    redirect_uri=http%3A%2F%2Flocalhost%3A9000%2Fcallback&amp;
    launch=xyz123&amp;
    scope=launch+user%2F*.*+openid+fhirUser+purpose_of_use%3Durn%3Aoid%3A2.16.756.5.30.1.127.3.10.5%7CNORM+subject_role%3Durn%3Aoid%3A2.16.756.5.30.1.127.3.10.6%7CHCP+person_id%3D761337610411353650%5E%5E%5E%262.16.756.5.30.1.109.6.5.3.1.1%26ISO&amp;
    code_challenge=ZmVjMmIwMWYyYTNjZWJiNTgyNTgxYzlmOGYyMWM0MWI3YmZhMjQ4YjU5MDc3Mzk4MDBmYTk0OThlNzZiNjAwMw&amp;
    code_challenge_method=S256
</span></code></pre></div></div>

<p>The second step of the conversation is an HTTP GET Callback conveying the authorization code and may look like:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">GET /callback?code=8V1pr0rJ&amp;state=98wrghuwuogerg97
</span></code></pre></div></div>

<p>The third step of the conversation is an HTTP POST sending the authorization code to retrieve the authorization token in the response which may look like:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST /token HTTP/1.1 
Host: localhost:9001

Accept: application/json
Content-type: application/x-www-form-urlencoded
Authorization: Basic bXktYXBwOm15LWFwcC1zZWNyZXQtMTIz
grant_type=authorization_code&amp;
code=98wrghuwuogerg97&amp;
code_verifier=qskt4342of74bkncmicdpv2qd143iqd822j41q2gupc5n3o6f1clxhpd2x11&amp;
access_token_format=urn:ietf:params:oauth:token-type:jwt
</span></code></pre></div></div>

<h4 id="get-access-token-response">Get Access Token Response</h4>

<h5 id="message-semantics-2">Message Semantics</h5>
<p>The response SHALL either convey a Basic Access Token in JWT format, granting basic access to the EPR (i.e. to access patient data), or an Extended Access Token to access resources protected by the role and attribute based EPR authorization (i.e. read and write documents).</p>

<h6 id="json-web-token-option">JSON Web Token Option</h6>

<p>The Authorization Server and Resource Server SHALL support the IUA JWT extension with the following claims as defined in Table <a href="#jwttiua">below</a>.</p>

<p>The claim content for the JWT IUA extensions SHALL correspond to the content defined in the XUA specification (see 1.6.4.2 Get X-User Assertion, A5E1).</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>JWT Claim (Extension)</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>XUA Attribute EPR</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>subject_name</td>
      <td>R/R</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:subject-id</td>
      <td>Plain text’s user name.</td>
    </tr>
    <tr>
      <td>subject_organization</td>
      <td>O/O</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:organization</td>
      <td>The name of the user’s organization or institution as text.</td>
    </tr>
    <tr>
      <td>subject_organization_id</td>
      <td>O/O</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:organization-id</td>
      <td>The OID of the user’s organization in URN notation.</td>
    </tr>
    <tr>
      <td>subject_role</td>
      <td>O/R</td>
      <td>urn:oasis:names:tc:xacml:2.0:subject:role</td>
      <td>Code indicating the user role. In the Swiss EPR the value SHALL be taken from the EPR Role Code Value Set.</td>
    </tr>
    <tr>
      <td>purpose_of_use</td>
      <td>O/R</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:purposeofuse</td>
      <td>Code indicating the purpose of use. In the Swiss EPR the value SHALL be taken from the EPR Purpose Of Use Value Set.</td>
    </tr>
    <tr>
      <td>home_community_id</td>
      <td>O/R</td>
      <td>urn:ihe:iti:xca:2010:homeCommunityId</td>
      <td>The user’s home community identifier where the request originated. Its value should be an OID in URN notation.</td>
    </tr>
    <tr>
      <td>person_id</td>
      <td>O/R</td>
      <td>urn:oasis:names:tc:xacml:2.0:resource:resource-id</td>
      <td>SHALL be the EPR-SPID of the patients EPR.</td>
    </tr>
  </tbody>
</table>

<figcaption id="jwttiua">Attributes of the IUA Get Access Token response in the JWT extension ihe_iua.</figcaption>

<h6 id="the-jwt-ch_epr-extension">The JWT ch_epr extension</h6>

<p>The Authorization Server and Resource Server SHALL support the following extensions to the JWT access token for an EPR user:</p>

<ul>
  <li>user_id: subject identifier according to Annex 5 E1, section 1.6.4.3.4.2 Message Semantics.</li>
</ul>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>JWT Claim (Extension)</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>XUA Attribute EPR</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>O/R</td>
      <td>&lt;NameID&gt; child element of the &lt;Subject&gt;</td>
      <td> </td>
    </tr>
    <tr>
      <td>user_id_qualifier</td>
      <td>O/R</td>
      <td>Name qualifier attribute of &lt;NameID&gt;</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<figcaption>Attributes of the IUA Get Access Token response in the JWT extension ch_delegation.</figcaption>

<h6 id="the-jwt-ch_group-extension">The JWT ch_group extension</h6>

<p>The Authorization Server and Resource Server SHALL support the following extensions to the JWT access token for a list of groups a subject is member of:</p>

<ul>
  <li>name: Name of the organization/group. The name SHALL be a string.</li>
  <li>id: The id of the organization/group.The id SHALL be an OID in the format of a URN</li>
</ul>

<p>The ch_group extension claims shall be wrapped in an “extensions” object with key ‘ch_group’ and a JSON array containing the JSON objects with properties name and id. The id SHALL be an OID in the format of a URN.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>ch_group array element</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>XUA Attribute EPR</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>name</td>
      <td>O/R</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:organization</td>
      <td>An array of groups with properties name and id.</td>
    </tr>
    <tr>
      <td>id</td>
      <td>O/R</td>
      <td>urn:oasis:names:tc:xspa:1.0:subject:organization-id</td>
      <td>An array of group names and group ids.</td>
    </tr>
  </tbody>
</table>

<figcaption>Attributes of the IUA Get Access Token response in the JWT extension ch_group.</figcaption>

<h6 id="the-jwt-ch_delegation-extension">The JWT ch_delegation extension</h6>

<p>The Authorization Server and Resource Server shall support the following extensions to the JWT access token:</p>

<ul>
  <li>principal (optional) Name of the healthcare professional an assistant is acting on behalf of.</li>
  <li>principal_id (optional) GLN of the healthcare professional an assistant is acting on behalf of.</li>
</ul>

<p>The ch_delegation extension claims shall be wrapped in an “extensions” object with key ‘ch_delegation’ and a JSON value object containing the claims.
The claim content for the JWT CH:EPR extensions shall correspond to the content defined in the XUA specification (see 1.6.4.2 Get X-User Assertion, A5E1).</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>JWT Claim (Extension)</th>
      <th>Optionality (Basic/ Extended)</th>
      <th>XUA Attribute EPR</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>principal</td>
      <td>O/R</td>
      <td>urn:e-health-suisse:principal-name</td>
      <td>Name of the healthcare professional an assistant is acting on behalf of.</td>
    </tr>
    <tr>
      <td>principal_id</td>
      <td>O/R</td>
      <td>urn:e-health-suisse:principal-id</td>
      <td>GLN of the healthcare professional an assistant is acting on behalf of.</td>
    </tr>
  </tbody>
</table>

<figcaption>Attributes of the IUA Get Access Token response in the JWT extension ch_delegation.</figcaption>

<h5 id="expected-actions-2">Expected Actions</h5>

<p>The IUA Authorization Server SHALL support the HTTP conversation of the OAuth 2.1 Authorization Code grant as follows:</p>

<p>If the IUA Authorization Server receives a request, it SHALL authenticate the user by redirecting the request to a Identity Provider using the Open ID Connect protocol. The Identity Provider authenticates the user based on its internal session management (i.e. by checking the requests cookies or other methods) or by validating the user authentication means and returns the identity token to the IUA Authorization Server.</p>

<p>In case of authentication failure, the IUA Authorization Server SHALL respond with HTTP error code 401 ‘Not authorized’.</p>

<p>The IUA Authorization Server SHALL identify the IUA Authorization Client (portal or primary system) based on the digital signature of the messages send by the IUA Authorization Client. The IUA Authorization Server SHALL use the X.509 certificate provided by the portal or primary system in the TLS connection to authenticate the IUA Authorization Client.</p>

<p>The IUA Authorization Server SHALL verify that the IUA Authorization Client (portal or primary system) is authorized to access the EPR on behalf of the users by checking if the IUA Authorization Client has been registered and authorized by the community during the onboarding process.</p>

<p>For SMART on FHIR Apps launched in an EHR Launch, the IUA Authorization Server SHALL validate the launch scope parameter, by verifying that the portal or primary system which launched the SMART on FHIR App has been registered with this launch parameter value by the community during the onboarding process.</p>

<p>In case of failure, the IUA Authorization Server SHALL respond with HTTP error code 401 ‘Not authorized’.</p>

<p>The IUA Authorization Server SHALL validate the scope claim. Depending on the scope claimed, the IUA Authorization Server SHALL either build a Basic Access Token authorizing basic access to the EPR (i.e. to access patient data), or an Extended Access Token to authorize access to resources protected by the role and attribute based EPR authorization (i.e. read and write documents).</p>

<p>The business rules for the IUA Authorization Server for the Healthcare Professional, Assistant, Patient and Representative Extension SHALL be the same as for Annex 5E1 1.6.4.2.4.4 Expected Actions X-Assertion Provider Extensions.</p>

<p>If successful the IUA Authorization Server SHALL generate an OAuth 2.1 authorization code and perform a callback to the URL defined in the request, using the OAuth authorization code as URL query parameter with key ‘code’.</p>

<p>The IUA Authorization Server SHALL store the access token and the assigned authorization code and respond the access token on request to the Authorization Client.</p>

<p><sup id="4">4</sup>This covers all possible EPR transaction, except the ITI-103 transaction.</p>

<h5 id="message-example-2">Message Example</h5>

<p>A JWT access token returned by the IUA Authorization Server and to be used to retrieve patient data may look like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://issuerAdress.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UserId-bfe8a208-b9d0-4012-b2f5-168b949fc3cb"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://pixmResourceServerURL.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294580000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nbf"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jti"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c5436729-3f26-4dbf-abd3-2790dc7771a"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"extensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
    </span><span class="nl">"ihe_iua"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
      </span><span class="nl">"subject_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Martina Musterarzt"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"home_community_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:1.2.3.4"</span><span class="w"> 
    </span><span class="p">},</span><span class="w"> 
    </span><span class="nl">"ch_epr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000000090092"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"user_id_qualifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:gs1:gln"</span><span class="w"> 
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A extend JWT access token to be used to access patient documents SHALL have the additional attributes of the purpose of use, subject role, the EPR-SPID of the patient and may look like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://issuerAdress.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UserId-bfe8a208-b9d0-4012-b2f5-168b949fc3cb"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://mhdResourceServerURL.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294580000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nbf"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jti"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c5436729-3f26-4dbf-abd3-2790dc7771a"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"extensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
    </span><span class="nl">"ihe_iua"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
      </span><span class="nl">"subject_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Martina Musterarzt"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"home_community_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:1.2.3.4"</span><span class="p">,</span><span class="w">  
      </span><span class="nl">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"761337610411353650^^^&amp;2.16.756.5.30.1.127.3.10.3&amp;ISO"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"subject_role"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.756.5.30.1.127.3.10.6"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HCP"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"purpose_of_use"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:uuid:2.16.756.5.30.1.127.3.10.5"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NORM"</span><span class="p">,</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> 
    </span><span class="nl">"ch_epr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000000090092"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"user_id_qualifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:gs1:gln"</span><span class="w"> 
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ch_group"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.1"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.2"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.3"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A JWT access token to be used to access by an assistant acting behalf on a healthcare professional for a patient SHALL have the additional extension ch_delegation:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://issuerAdress.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UserId-bfe8a208-b9d0-4012-b2f5-168b949fc3cb"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://mhdResourceServerURL.ch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294580000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nbf"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1587294460000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jti"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c5436729-3f26-4dbf-abd3-2790dc7771a"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"extensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
    </span><span class="nl">"ihe_iua"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
      </span><span class="nl">"subject_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dagmar Musterassistent"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"home_community_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:1.2.3.4"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"761337610411353650^^^&amp;2.16.756.5.30.1.127.3.10.3&amp;ISO"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"subject_role"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.756.5.30.1.127.3.10.6"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HCP"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"purpose_of_use"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:uuid:2.16.756.5.30.1.127.3.10.5"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NORM"</span><span class="p">,</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> 
    </span><span class="nl">"ch_epr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000000090108"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"user_id_qualifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:gs1:gln"</span><span class="w"> 
    </span><span class="p">},</span><span class="w"> 
    </span><span class="nl">"ch_group"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.1"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.2"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of group with id urn:oid:2.2.2.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.2.2.3"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"ch_delegation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"principal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Martina Musterarzt"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"principal_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000000090092"</span><span class="w"> 
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="capabilitystatement-resource">CapabilityStatement Resource</h4>

<p>There are no CapabilityStatement resources defined for this transaction.</p>

<h3 id="security-consideration">Security Consideration</h3>

<p>IUA Authorization Clients, Authorization Servers and Resource Server actors SHALL use the JWS (signed) alternative 
of the JWT token as specified in the IUA Trial Implementation. The JWE alternative SHALL not be used.</p>

<p>For the <code class="language-plaintext highlighter-rouge">traceparent</code> header handling refer to <a href="tracecontext.html">Trace Context header</a>.</p>

<h4 id="security-audit-considerations">Security Audit Considerations</h4>

<p>There is no audit event required for this transaction.</p>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript" src="assets/js/window-hash.js"> </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &#169; 2020+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.e-health-suisse.ch">eHealth Suisse</a>.  Package ch.fhir.ig.ch-epr-fhir#4.0.1-ballot based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Thu, May 16, 2024 21:43+0000">2024-05-16</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                

| <a style="color: #81BEF7" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSffM9HysTOg3VdMOeaFmWiWGH0OQT-FZLmwZaeXgZqUr66Y0A/viewform?usp=sf_link&amp;entry%2E1353807103=ch.fhir.ig.ch-epr-fhir%234.0.1-ballot%20/iti-71.html&amp;entry%2E247644557=Get%20Access%20Token%20[ITI-71]">Propose a change</a>




          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script type="text/javascript" src="assets/js/anchor-hover.js"> </script>
  
  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

