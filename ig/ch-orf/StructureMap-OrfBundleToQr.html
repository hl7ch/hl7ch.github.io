<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>CH.FHIR.IG.CH-ORF\Map ORF - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
    <link href="assets/css/hl7.css" rel="stylesheet"/>
    <link href="assets/css/fhir.css" rel="stylesheet"/>

    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"10.27"}
    h3,h4,h5,h6{--heading-prefix:"10.27"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

            <!--
<div id="family-nav">
	<a id="logo" no-external="true" href="http://hl7.org/fhir"> <img
		alt="logo fhir" src="assets/images/fhir-logo-www.png" />
	</a>
</div>
-->


            <div id="hl7-nav">
    <a id="hl7-logo" no-external="true" href="http://www.hl7.ch">
        <img alt="visit the hl7 website" height="50" src="hl7-logo.png" />
    </a>            
</div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">CH ORF (R4)</span><br/>0.10.0 - STU 1 Ballot</p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <!--<li>
    <a href="toc.html">Table of Contents</a>
  </li>-->
  <li>
    <a href="index.html">Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Use Cases<b class="caret">
      </b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="usecase-english.html">English</a>
      </li>
      <li>
        <a href="usecase-german.html">German</a>
      </li>
      <li>
        <a href="usecase-french.html">French</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="questionnaire.html">Questionnaire</a>
  </li>
  <li>
    <a href="document.html">Document</a>
  </li>
  <li>
    <a href="profiles.html">Profiles</a>
  </li>
  <li>
    <a href="extensions.html">Extensions</a>
  </li>
  <li>
    <a href="terminology.html">Terminology</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><a href='artifacts.html'><b>Artifacts Summary</b></a></li><li><b>Map ORF</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the CH ORF (R4) (v0.10.0: <a href="https://confluence.hl7.org/display/HL7/HL7+Balloting" title="Standard for Trial-Use">STU</a> 1) based on <a href="http://hl7.org/fhir/R4">FHIR R4</a>. .  For a full list of available versions, see the <a href="http://fhir.ch/ig/ch-orf/history.html">Directory of published versions <img src="external.png" style="text-align: baseline"></a></p><!--EndReleaseHeader-->

  






<ul class="nav nav-tabs">

  <li class="active">
    <a href="#">Narrative Content</a>
  </li>


  
    <li>
      <a href="StructureMap-OrfBundleToQr.xml.html">XML</a>
    </li>
  


  
    <li>
      <a href="StructureMap-OrfBundleToQr.json.html">JSON</a>
    </li>
  


  
    <li>
      <a href="StructureMap-OrfBundleToQr.ttl.html">TTL</a>
    </li>
  



</ul>


  <a name="root"> </a>


  <h2 id="root">StructureMap: Map ORF</h2>


  


  <!-- insert intro if present -->
  



  <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map &quot;http://fhir.ch/ig/ch-orf/StructureMap/OrfBundleToQr&quot; = &quot;OrfBundleToQr&quot;

// ORF Bundle To QuestionnaireResonse
// Bundle: http://build.fhir.org/ig/hl7ch/ch-orf/StructureDefinition-ch-orf-document.html
// QRF Questionnaire Response: http://build.fhir.org/ig/hl7ch/ch-orf/QuestionnaireResponse-referral-min.xml.html

uses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias Bundle as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Composition&quot; alias Composition as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Patient&quot; alias Patient as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Organization&quot; alias Organization as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot; alias Practitioner as source
uses &quot;http://hl7.org/fhir/StructureDefinition/PractitionerRole&quot; alias PractitionerRole as source
uses &quot;http://hl7.org/fhir/StructureDefinition/ServiceRequest&quot; alias ServiceRequest as source
uses &quot;http://hl7.org/fhir/StructureDefinition/BackboneElement&quot; alias BackboneElement as source
uses &quot;http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse&quot; alias QuestionnaireResponse as target

group OrfBundleToQr(source bundle : Bundle, target qr : QuestionnaireResponse) {
  bundle -&gt; qr.questionnaire = 'http://fhir.ch/ig/ch-orf/Questionnaire/order-referral-form' &quot;questionnaire&quot;;
  bundle -&gt; qr.status = 'completed' &quot;status&quot;;
  bundle.entry first as entry then {
    entry.resource as composition then {
      composition.section as section then {
        bundle.entry as entry then {
          entry.fullUrl where ($this in %section.entry.reference) and $this.startsWith('urn:uuid') then {
            entry.resource : ServiceRequest as serviceRequest then CompositionToQr(bundle, composition, serviceRequest, qr) &quot;servicerequest&quot;;
          } &quot;fullUrlAsUuid&quot;;
          entry.resource : ServiceRequest as serviceRequest where ('ServiceRequest' + '/' + $this.id) in %section.entry.reference then CompositionToQr(bundle, composition, serviceRequest, qr) &quot;servicerequest&quot;;
        };
      };
    };
  };
}

group CompositionToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target qr : QuestionnaireResponse) {
  composition -&gt;  qr.item as item,  item.linkId = 'order' then OrderToQr(bundle, composition, serviceRequest, item) &quot;order&quot;;
  composition.extension as ext where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-receiver' -&gt;  qr.item as item,  item.linkId = 'receiver' then ReceiverToQr(bundle, serviceRequest, ext, item) &quot;receiver&quot;;
  composition.subject -&gt;  qr.item as item,  item.linkId = 'patient' then PatientToQr(bundle, composition, serviceRequest, item) &quot;patient&quot;;
  serviceRequest.extension as ext where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-requestedencounterdetails' -&gt;  qr.item as item,  item.linkId = 'requestedEncounter' then RequestedEncounterDetailsToQr(bundle, ext, item) &quot;requestedEncounter&quot;;
  serviceRequest.insurance first as insurance -&gt;  qr.item as item,  item.linkId = 'coverage' then CoverageToQr(bundle, composition, serviceRequest, item) &quot;requestedEncounter&quot;;
  composition.author -&gt;  qr.item as item,  item.linkId = 'sender' then SenderToQr(bundle, composition, serviceRequest, item) &quot;sender&quot;;
  composition.extension first as extension where (url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-copyreceiver') -&gt;  qr.item as item,  item.linkId = 'receiverCopies' then ReceiverCopyToQr(bundle, composition, serviceRequest, item) &quot;receiverCopies&quot;;
  serviceRequest.extension as ext where url = 'ch-orf-locationandtime' -&gt;  qr.item as item,  item.linkId = 'appointment' then AppointmentDetailsToQr(bundle, ext, item) &quot;apopintments&quot;;
  serviceRequest.note first as note -&gt;  qr.item as item,  item.linkId = 'note' then NoteToQr(serviceRequest, item);
}

group OrderToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target item : BackboneElement) {
  // &lt;linkId value=&quot;order.title&quot; /&gt;
  composition.title as title -&gt;  item.item as itemfirst,  itemfirst.linkId = 'order.title',  itemfirst.answer as answer,  answer.value = title;
  // &lt;linkId value=&quot;order.type&quot; /&gt;
  composition.type as comptype then {
    comptype.coding as coding -&gt;  item.item as itemfirst,  itemfirst.linkId = 'order.type',  itemfirst.answer as answer,  answer.value = coding &quot;type&quot;;
  } &quot;CodeableConceptType&quot;;
  // &lt;linkId value=&quot;order.category&quot; /&gt;
  composition.category as compcat then {
    compcat.coding as coding -&gt;  item.item as itemfirst,  itemfirst.linkId = 'order.category',  itemfirst.answer as answer,  answer.value = coding &quot;category&quot;;
  } &quot;CodeableConceptType&quot;;
  // &lt;linkId value=&quot;order.placerOrderIdentifierDomain&quot; /&gt;
  serviceRequest.identifier as identifier where (type.coding.where((system.value = 'http://terminology.hl7.org/CodeSystem/v2-0203') and (code.value = 'PLAC'))) -&gt;  item.item as itemfirst,  itemfirst.linkId = 'order.placerOrderIdentifier',  itemfirst.answer as answer,  answer.value = (identifier.value) then {
    identifier.system as system -&gt;  item.item as itemsecond,  itemsecond.linkId = 'order.placerOrderIdentifierDomain',  itemsecond.answer as answer,  answer.value = cast(system, 'string') &quot;placerOrderIdentifierDomain&quot;;
  } &quot;placerOrderIdentifierDomain&quot;;
  // &lt;linkId value=&quot;order.fillerOrderIdentifier&quot; /&gt;
  serviceRequest.identifier as identifier where (type.coding.where((system.value = 'http://terminology.hl7.org/CodeSystem/v2-0203') and (code.value = 'FILL'))) -&gt;  item.item as itemfirst,  itemfirst.linkId = 'order.fillerOrderIdentifier',  itemfirst.answer as answer,  answer.value = (identifier.value) then {
    identifier.system as system -&gt;  item.item as itemsecond,  itemsecond.linkId = 'order.fillerOrderIdentifierDomain',  itemsecond.answer as answer,  answer.value = cast(system, 'string') &quot;fillerOrderIdentifier&quot;;
  } &quot;fillerOrderIdentifierDomain&quot;;
  // &lt;linkId value=&quot;order.precedentDocumentIdentifier&quot; /&gt;
  composition.extension as extension where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-precedentdocument' then {
    extension.value as value where value.startsWith('urn:uuid:') -&gt;  item.item as item,  item.linkId = 'order.precedentDocumentIdentifier',  item.answer as answer,  answer.value = (value.value.substring(9)) &quot;precedentDocumentIdentifier&quot;;
  } &quot;composition&quot;;
  // 'order.dateTime'- currently not mapped in qr response
  composition.extension as extension where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-urgentnoficationcontactforthisdocument' then {
    extension.value as value then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %value.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : PractitionerRole as practitionerRole then UrgentNotificationToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : PractitionerRole as practitionerRole where ('PractitionerRole' + '/' + $this.id) in %value.reference then UrgentNotificationToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
      };
    };
  } &quot;composition&quot;;
  // Urgent Notification Contact for the Response to this document
  composition.extension as extension where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-urgentnoficationcontactfortheresponsetothisdocument' then {
    extension.value as value then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %value.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : PractitionerRole as practitionerRole then UrgentNotificationResponseToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : PractitionerRole as practitionerRole where ('PractitionerRole' + '/' + $this.id) in %value.reference then UrgentNotificationResponseToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
      };
    };
  } &quot;composition&quot;;
  // order.priority
  serviceRequest.priority as priority -&gt;  item.item as item,  item.linkId = 'order.priority',  item.answer as answer,  answer.value = create('Coding') as coding,  coding.system = 'http://hl7.org/fhir/request-priority',  coding.code = priority;
}

group UrgentNotificationToQr(source bundle : Bundle, source composition : Composition, source practitionerRole : PractitionerRole, target item : BackboneElement) {
  composition -&gt;  item.item as itemgroup,  itemgroup.linkId = 'order.notificationContactDocument',  itemgroup.item as item,  item.linkId = 'order.notificationContactDocument.practitioner' then {
    practitionerRole.practitioner as practitioner then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %practitioner.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Practitioner as practitioner then UrgentNotificationPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Practitioner as practitioner where ('Practitioner' + '/' + $this.id) in %practitioner.reference then UrgentNotificationPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
      };
    };
  } &quot;urgentnotification&quot;;
}

group UrgentNotificationPractitionerToQr(source bundle : Bundle, source composition : Composition, source practitioner : Practitioner, target item : BackboneElement) {
  practitioner.name as name then {
    // order.notificationContactDocument.practitioner.title
    name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocument.practitioner.title',  item.answer as answer,  answer.value = prefix;
    // order.notificationContactDocument.practitioner.familyName
    name.family as family -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocument.practitioner.familyName',  item.answer as answer,  answer.value = family;
    // order.notificationContactDocument.practitioner.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocument.practitioner.givenName',  item.answer as answer,  answer.value = given;
  };
  // order.notificationContactDocument.practitioner.phone
  practitioner.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocument.practitioner.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // order.notificationContactDocument.practitioner.memaol
  practitioner.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocument.practitioner.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
}

group UrgentNotificationResponseToQr(source bundle : Bundle, source composition : Composition, source practitionerRole : PractitionerRole, target item : BackboneElement) {
  // order.notificationContactDocumentResponse
  composition -&gt;  item.item as itemgroup,  itemgroup.linkId = 'order.notificationContactDocumentResponse',  itemgroup.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner' then {
    practitionerRole.practitioner as practitioner then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %practitioner.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Practitioner as practitioner then UrgentNotificationResponsePractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Practitioner as practitioner where ('Practitioner' + '/' + $this.id) in %practitioner.reference then UrgentNotificationResponsePractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
      };
    };
  } &quot;urgentnotification&quot;;
}

group UrgentNotificationResponsePractitionerToQr(source bundle : Bundle, source composition : Composition, source practitioner : Practitioner, target item : BackboneElement) {
  practitioner.name as name then {
    // order.notificationContactDocumentResponse.practitioner.title
    name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner.title',  item.answer as answer,  answer.value = prefix;
    // order.notificationContactDocumentResponse.practitioner.familyName
    name.family as family -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner.familyName',  item.answer as answer,  answer.value = family;
    // order.notificationContactDocumentResponse.practitioner.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner.givenName',  item.answer as answer,  answer.value = given;
  };
  // order.notificationContactDocumentResponse.practitioner.phone
  practitioner.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // order.notificationContactDocumentResponse.practitioner.memaol
  practitioner.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'order.notificationContactDocumentResponse.practitioner.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
}

group ReceiverToQr(source bundle : Bundle, source composition : Composition, source ext : Extension, target item : BackboneElement) {
  bundle.entry as entry then {
    entry.fullUrl where ($this in %ext.valueReference.reference) and $this.startsWith('urn:uuid') then {
      entry.resource : PractitionerRole as practitionerRole then ReceiverPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitioner&quot;;
    } &quot;fullUrlAsUuid&quot;;
    entry.resource : PractitionerRoler as practitionerRole where ('PractitionerRole' + '/' + $this.id) in %ext.valueReference.reference then ReceiverPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitioner&quot;;
  };
}

group ReceiverPractitionerRoleToQr(source bundle : Bundle, source composition : Composition, source practitionerRole : PractitionerRole, target itemgroup : BackboneElement) {
  practitionerRole.practitioner as practitioner -&gt;  itemgroup.item as item,  item.linkId = 'receiver.practitioner' then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %practitioner.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : Practitioner as practitioner then ReceiverPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : Practitioner as practitioner where ('Practitioner' + '/' + $this.id) in %practitioner.reference then ReceiverPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
    };
  };
  practitionerRole.organization as organization -&gt;  itemgroup.item as item,  item.linkId = 'receiver.organization' then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %organization.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : Organization as organization then ReceiverOrganizationToQr(bundle, composition, organization, item) &quot;organization&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : Organization as organization where ('Organization' + '/' + $this.id) in %organization.reference then ReceiverOrganizationToQr(bundle, composition, practitioner, item) &quot;organization&quot;;
    };
  };
}

group ReceiverPractitionerToQr(source bundle : Bundle, source composition : Composition, source practitioner : Practitioner, target item : BackboneElement) {
  practitioner.name as name then {
    // receiver.practitioner.title
    name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.title',  item.answer as answer,  answer.value = prefix;
    // receiver.practitioner.familyName
    name.family as family -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.familyName',  item.answer as answer,  answer.value = family;
    // receiver.practitioner.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.givenName',  item.answer as answer,  answer.value = given;
  };
  // receiver.practitioner.gln
  practitioner.identifier as identifier where (system = 'urn:oid:2.51.1.3') then {
    identifier.value as value -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.gln',  item.answer as answer,  answer.value = cast(value, 'string') &quot;gln&quot;;
  };
  // receiver.practitioner.phone
  practitioner.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // receiver.practitioneremail
  practitioner.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'receiver.practitioner.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
}

group ReceiverOrganizationToQr(source bundle : Bundle, source composition : Composition, source organization : Organization, target item : BackboneElement) {
  // receiver.organization.name
  organization.name as name -&gt;  item.item as item,  item.linkId = 'receiver.organization.name',  item.answer as answer,  answer.value = name;
  // receiver.organization.streetAddressLine
  organization.address as addr then {
    addr.line first as line1 -&gt;  item.item as item,  item.linkId = 'receiver.organization.streetAddressLine' then {
      addr.line as line -&gt;  item.answer as answer,  answer.value = line;
    } &quot;addrlinefirst&quot;;
    // receiver.organization.postalCode
    addr.postalCode as postalCode -&gt;  item.item as item,  item.linkId = 'receiver.organization.postalCode',  item.answer as answer,  answer.value = postalCode;
    // receiver.organization.city
    addr.city as city -&gt;  item.item as item,  item.linkId = 'receiver.organization.city',  item.answer as answer,  answer.value = city;
    // receiver.organization.country
    addr.country as country -&gt;  item.item as item,  item.linkId = 'receiver.organization.country',  item.answer as answer,  answer.value = country;
  } &quot;addr&quot;;
}

group PatientToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target item : BackboneElement) {
  composition.subject as subject then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %subject.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : Patient as patient then PatientDetailsToQr(bundle, composition, patient, item) &quot;patient&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : Patient as patient where ('Patient' + '/' + $this.id) in %subject.reference then PatientDetailsToQr(bundle, composition, patient, item) &quot;patient&quot;;
    };
  } &quot;practitioner&quot;;
}

group PatientDetailsToQr(source bundle : Bundle, source composition : Composition, source patient : Patient, target item : BackboneElement) {
  // patient.familyName
  patient.name as name where (use.empty() or (use = 'official')) then {
    name.family as family -&gt;  item.item as item,  item.linkId = 'patient.familyName',  item.answer as answer,  answer.value = family;
  } &quot;familyName&quot;;
  patient.name as name where use = 'maiden' then {
    name.family as family -&gt;  item.item as item,  item.linkId = 'patient.maidenName',  item.answer as answer,  answer.value = family &quot;maidenName&quot;;
  } &quot;maidenName&quot;;
  patient.name as name where (use.empty() or (use = 'official')) then {
    // patient.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'patient.givenName',  item.answer as answer,  answer.value = given;
  } &quot;givenName&quot;;
  // patient.localPid
  patient.identifier as identifier where (type.coding.where((system.value = 'http://terminology.hl7.org/CodeSystem/v2-0203') and (code.value = 'MR'))) -&gt;  item.item as item1,  item1.linkId = 'patient.localPid',  item1.answer as answer,  answer.value = (identifier.value) then {
    identifier.system as system -&gt;  item.item as item2,  item2.linkId = 'patient.localPidDomain',  item2.answer as answer,  answer.value = cast(system, 'string') &quot;placerOrderIdentifierDomain&quot;;
  } &quot;localPid&quot;;
  // patient.birthDate
  patient.birthDate as birthDate -&gt;  item.item as item,  item.linkId = 'patient.birthDate',  item.answer as answer,  answer.value = birthDate;
  // patient.gender
  patient.gender as gender -&gt;  item.item as item,  item.linkId = 'patient.gender',  item.answer as answer,  answer.value = create('Coding') as coding,  coding.system = 'http://hl7.org/fhir/administrative-gender',  coding.code = gender;
  // patient.phone
  patient.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'patient.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // patient.email
  patient.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'patient.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
  patient.address as addr then {
    addr.line first as line1 -&gt;  item.item as item,  item.linkId = 'patient.streetAddressLine' then {
      addr.line as line -&gt;  item.answer as answer,  answer.value = line;
    } &quot;addrlinefirst&quot;;
    // patient.postalCode
    addr.postalCode as postalCode -&gt;  item.item as item,  item.linkId = 'patient.postalCode',  item.answer as answer,  answer.value = postalCode;
    // patient.city
    addr.city as city -&gt;  item.item as item,  item.linkId = 'patient.city',  item.answer as answer,  answer.value = city;
    // patient.country
    addr.country as country -&gt;  item.item as item,  item.linkId = 'patient.country',  item.answer as answer,  answer.value = country;
  } &quot;addr&quot;;
  // patient.contactperson
  patient.contact as contact -&gt;  item.item as item,  item.linkId = 'patient.contactperson' then {
    // patient.contactperson.relationship
    contact.relationship as relationship then {
      relationship.text as text -&gt;  item.item as item,  item.linkId = 'patient.contactperson.relationship',  item.answer as answer,  answer.value = text &quot;relationship&quot;;
    };
    contact.name as name then {
      // patient.contactperson.familyName
      name.family as family -&gt;  item.item as item,  item.linkId = 'patient.contactperson.familyName',  item.answer as answer,  answer.value = family &quot;familyName&quot;;
      // patient.contactperson.givenName
      name.given as given -&gt;  item.item as item,  item.linkId = 'patient.contactperson.givenName',  item.answer as answer,  answer.value = given &quot;givenName&quot;;
    };
    // patient.contactperson.phone
    contact.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'patient.contactperson.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
    // patient.contactperson.email
    contact.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'patient.contactperson.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
  };
}

group RequestedEncounterDetailsToQr(source bundle : Bundle, source ext : Extension, target item : BackboneElement) {
  bundle.entry as entry then {
    entry.fullUrl where ($this in %ext.valueReference.reference) and $this.startsWith('urn:uuid') then {
      entry.resource : Encounter as encounter then EncounterToQr(encounter, item) &quot;encounter&quot;;
    } &quot;fullUrlAsUuid&quot;;
    entry.resource : Encounter as encounter where ('Encounter' + '/' + $this.id) in %ext.valueReference.reference then EncounterToQr(encounter, item) &quot;encounter&quot;;
  };
}

group EncounterToQr(source encounter : Encounter, target item : BackboneElement) {
  // requestedEncounter.class
  encounter.class as class -&gt;  item.item as item,  item.linkId = 'requestedEncounter.class',  item.answer as answer,  answer.value = class;
  // requestedEncounter.desiredAccommodation
  encounter.extension as extension where url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-desiredaccommodation' then {
    extension.value as value -&gt;  item.item as item,  item.linkId = 'requestedEncounter.desiredAccommodation',  item.answer as answer,  answer.value = value &quot;desiredAccommodation&quot;;
  } &quot;desiredAccommodation&quot;;
}

group AppointmentDetailsToQr(source bundle : Bundle, source ext : Extension, target item : BackboneElement) {
  bundle.entry as entry then {
    entry.fullUrl where ($this in %ext.valueReference.reference) and $this.startsWith('urn:uuid') then {
      entry.resource : Appointment as appointment then AppointmentToQr(appointment, item) &quot;appointment&quot;;
    } &quot;fullUrlAsUuid&quot;;
    entry.resource : Appointment as appointment where ('Appointment' + '/' + $this.id) in %ext.valueReference.reference then AppointmentToQr(appointment, item) &quot;encounter&quot;;
  };
}

group LocationToQr(source loc : Locaton, target item : BackboneElement) {
  loc -&gt;  item.item as item,  item.linkId = 'appointment.location' then {
    // appointment.location.name
    location.name as name -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.name',  answer.value = name;
    // appointment.location.phone
    location.telecom as telecom where system = 'phone' -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.phone',  answer.value = (%telecom.value) &quot;phone&quot;;
    // appointment.location.email
    location.telecom as telecom where system = 'email' -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.email',  answer.value = (%telecom.value) &quot;email&quot;;
    location.addr as addr then {
      // appointment.location.streetAddressLine
      addr.streetAddressLine as line -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.streetAddressLine',  answer.value = line;
      // appointment.location.postalCode
      addr.postalCode as postalCode -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.postalCode',  answer.value = postalCode;
      // appointment.location.city
      addr.city as city -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.city',  answer.value = city;
      // appointment.location.country
      addr.country as country -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.location.country',  answer.value = country;
    };
  } &quot;location&quot;;
}

group AppointmentToQr(source app : Appointment, target item : BackboneElement) {
  // appointment.location
  app.participant as particiapnt then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %participant.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : Location as location then LocationToQr(location, item) &quot;location&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : Location as location where ('Location' + '/' + $this.id) in %participant.reference then LocationToQr(location, item) &quot;location&quot;;
    };
  };
  // appointment.requestedPeriod
  app.requestedPeriod as requestedPeriod -&gt;  item.item as item,  item.linkId = 'appointment.requestedPeriod' then {
    // appointment.requestedPeriod.start
    requestedPeriod.start as start -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.requestedPeriod.start',  answer.value = start;
    // appointment.requestedPeriod.end
    requestedPeriod.end as end -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.requestedPeriod.end',  answer.value = end;
  };
  // appointment.status
  app.status as status -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.requestedPeriod.status',  answer.value = status;
  // appointment.patientInstruction
  app.patientInstruction as patientInstruction -&gt;  item.item as itemloc,  itemloc.linkId = 'appointment.patientInstruction',  answer.value = patientInstruction;
}

group CoverageBeneficiary(source patient : Patient, target item : BackboneElement) {
  patient.identifier as identifier where system = 'urn:oid:2.16.756.5.32' -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.beneficiary',  itemkvg.item as itemname,  itemname.linkId = 'coverage.beneficiary.ahvn13',  itemname.answer as answer,  answer.value = (%identifier.value) &quot;ahvn13&quot;;
}

group CoverageKvg(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.kvg',  itemkvg.item as itemname,  itemname.linkId = 'coverage.kvg.name',  itemname.answer as answer,  answer.value = (%coverage.contained.name),  itemkvg.item as itemno,  itemno.linkId = 'coverage.kvg.insuranceCardNumber',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;kvg&quot;;
}

group CoverageUvg(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.uvg',  itemkvg.item as itemname,  itemname.linkId = 'coverage.uvg.name',  itemname.answer as answer,  answer.value = (%coverage.contained.name),  itemkvg.item as itemno,  itemno.linkId = 'coverage.uvg.claimNumber',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;uvg&quot;;
}

group CoverageVvg(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.vvg',  itemkvg.item as itemname,  itemname.linkId = 'coverage.vvg.name',  itemname.answer as answer,  answer.value = (%coverage.contained.name),  itemkvg.item as itemno,  itemno.linkId = 'coverage.vvg.insuranceCardNumber',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;vvg&quot;;
}

group CoverageIvg(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.iv',  itemkvg.item as itemno,  itemno.linkId = 'coverage.iv.verfuegungsnummer',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;iv&quot;;
}

group CoverageMvg(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.mv',  itemkvg.item as itemno,  itemno.linkId = 'coverage.mv.versichertennummer',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;mv&quot;;
}

group CoverageSelf(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.self',  itemkvg.item as itemname,  itemname.linkId = 'coverage.self.familyName',  itemname.answer as answer,  answer.value = (%coverage.contained.name.family),  itemkvg.item as itemno,  itemno.linkId = 'coverage.self.givenName',  itemno.answer as answer,  answer.value = (%coverage.contained.name.given) &quot;uvg&quot;;
}

group CoverageOther(source coverage : Coverage, target item : BackboneElement) {
  coverage -&gt;  item.item as itemkvg,  itemkvg.linkId = 'coverage.other',  itemkvg.item as itemname,  itemname.linkId = 'coverage.other.name',  itemname.answer as answer,  answer.value = (%coverage.contained.name),  itemkvg.item as itemno,  itemno.linkId = 'coverage.other.id',  itemno.answer as answer,  answer.value = (%coverage.identifier.value) &quot;uvg&quot;;
}

group CoverageToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target item : BackboneElement) {
  composition.subject as subject then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %subject.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : Patient as patient then CoverageBeneficiary(patient, item) &quot;patient&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : Patient as patient where ('Patient' + '/' + $this.id) in %subject.reference then CoverageBeneficiary(patient, item) &quot;patient&quot;;
    };
  } &quot;practitioner&quot;;
  bundle.entry as entry then {
    entry.fullUrl where ($this in %serviceRequest.insurance.reference) and $this.startsWith('urn:uuid') then {
      entry.resource : Coverage as coverage where (type.coding.code = 'KVG') then CoverageKvg(coverage, item) &quot;coveragekvg&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'UVG') then CoverageUvg(coverage, item) &quot;coverageuvg&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'VVG') then CoverageVvg(coverage, item) &quot;coverageVvg&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'IVG') then CoverageIvg(coverage, item) &quot;coverageVvg&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'MVG') then CoverageMvg(coverage, item) &quot;coverageVvg&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'Self') then CoverageSelf(coverage, item) &quot;coverageSelf&quot;;
      entry.resource : Coverage as coverage where (type.coding.code = 'Other') then CoverageOther(coverage, item) &quot;coverageOth4r&quot;;
    } &quot;fullUrlAsUuid&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'KVG') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageKvg(coverage, item) &quot;coveragekvg&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'UVG') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageUvg(coverage, item) &quot;coverageuvg&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'VVG') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageVvg(coverage, item) &quot;coverageuvg&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'IVG') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageIvg(coverage, item) &quot;coverageivg&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'MVG') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageMvg(coverage, item) &quot;coveragemvg&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'Self') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageSelf(coverage, item) &quot;coverageself&quot;;
    entry.resource : Coverage as coverage where (type.coding.code = 'Other') and (('Coverage' + '/' + $this.id) in %serviceRequest.insurance.reference) then CoverageOther(coverage, item) &quot;coverageother&quot;;
  };
}

group SenderToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target item : BackboneElement) {
  composition.author as author then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %author.reference) and $this.startsWith('urn:uuid') then {
        entry.resource : PractitionerRole as practitionerRole then SenderPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitioner&quot;;
      } &quot;fullUrlAsUuid&quot;;
      entry.resource : PractitionerRoler as practitionerRole where ('PractitionerRole' + '/' + $this.id) in %author.reference then SenderPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitioner&quot;;
    };
  };
  composition.extension as ext where (url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-dataenterer') then {
    ext.extension as extension where (url = 'enterer') then {
      extension.value as value then {
        bundle.entry as entry then {
          entry.fullUrl where ($this in %value.reference) and $this.startsWith('urn:uuid') then {
            entry.resource : PractitionerRole as practitionerRole then DataEntererPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
          } &quot;fullUrlAsUuid&quot;;
          entry.resource : PractitionerRole as practitionerRole where ('PractitionerRole' + '/' + $this.id) in %value.reference then DataEntererPractitionerRoleToQr(bundle, composition, practitionerRole, item) &quot;practitionerRole&quot;;
        };
      };
    } &quot;enterer&quot;;
  } &quot;dataenterer&quot;;
}

group SenderPractitionerRoleToQr(source bundle : Bundle, source composition : Composition, source practitionerRole : PractitionerRole, target itemsender : BackboneElement) {
  composition -&gt;  itemsender.item as itemgroup,  itemgroup.linkId = 'sender.author' then {
    practitionerRole.practitioner as practitioner -&gt;  itemgroup.item as item,  item.linkId = 'sender.author.practitioner' then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %practitioner.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Practitioner as practitioner then SenderPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Practitioner as practitioner where ('Practitioner' + '/' + $this.id) in %practitioner.reference then SenderPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
      };
    };
    practitionerRole.organization as organization -&gt;  itemgroup.item as item,  item.linkId = 'sender.author.organization' then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %organization.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Organization as organization then SenderOrganizationToQr(bundle, composition, organization, item) &quot;organization&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Organization as organization where ('Organization' + '/' + $this.id) in %organization.reference then SenderOrganizationToQr(bundle, composition, practitioner, item) &quot;organization&quot;;
      };
    };
  } &quot;author&quot;;
}

group SenderPractitionerToQr(source bundle : Bundle, source composition : Composition, source practitioner : Practitioner, target item : BackboneElement) {
  practitioner.name as name then {
    // sender.author.practitioner.title
    name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.title',  item.answer as answer,  answer.value = prefix;
    // sender.author.practitioner.familyName
    name.family as family -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.familyName',  item.answer as answer,  answer.value = family;
    // sender.author.practitioner.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.givenName',  item.answer as answer,  answer.value = given;
  };
  // sender.author.practitioner.gln
  practitioner.identifier as identifier where (system = 'urn:oid:2.51.1.3') then {
    identifier.value as value -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.gln',  item.answer as answer,  answer.value = cast(value, 'string') &quot;gln&quot;;
  };
  // sender.author.practitioner.phone
  practitioner.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // sender.author.practitioneremila
  practitioner.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'sender.author.practitioner.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
}

group SenderOrganizationToQr(source bundle : Bundle, source composition : Composition, source organization : Organization, target item : BackboneElement) {
  // sender.author.organization.name
  organization.name as name -&gt;  item.item as item,  item.linkId = 'sender.author.organization.name',  item.answer as answer,  answer.value = name;
  // sender.author.organization.streetAddressLine
  organization.address as addr then {
    addr.line first as line1 -&gt;  item.item as item,  item.linkId = 'sender.author.organization.streetAddressLine' then {
      addr.line as line -&gt;  item.answer as answer,  answer.value = line;
    } &quot;addrlinefirst&quot;;
    // sender.author.organization.postalCode
    addr.postalCode as postalCode -&gt;  item.item as item,  item.linkId = 'sender.author.organization.postalCode',  item.answer as answer,  answer.value = postalCode;
    // sender.author.organization.city
    addr.city as city -&gt;  item.item as item,  item.linkId = 'sender.author.organization.city',  item.answer as answer,  answer.value = city;
    // sender.author.organization.country
    addr.country as country -&gt;  item.item as item,  item.linkId = 'sender.author.organization.country',  item.answer as answer,  answer.value = country;
  } &quot;addr&quot;;
}

group DataEntererPractitionerRoleToQr(source bundle : Bundle, source composition : Composition, source practitionerRole : PractitionerRole, target itemsender : BackboneElement) {
  composition -&gt;  itemsender.item as itemgroup,  itemgroup.linkId = 'sender.dataenterer' then {
    practitionerRole.practitioner as practitioner -&gt;  itemgroup.item as item,  item.linkId = 'sender.dataenterer.practitioner' then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %practitioner.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Practitioner as practitioner then DataEntererPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Practitioner as practitioner where ('Practitioner' + '/' + $this.id) in %practitioner.reference then DataEntererPractitionerToQr(bundle, composition, practitioner, item) &quot;practitioner&quot;;
      };
    };
  } &quot;dataenterer&quot;;
}

group DataEntererPractitionerToQr(source bundle : Bundle, source composition : Composition, source practitioner : Practitioner, target item : BackboneElement) {
  // sender.dataenterer.practitioner.familyName
  practitioner.name as name then {
    name.family as family -&gt;  item.item as item,  item.linkId = 'sender.dataenterer.practitioner.familyName',  item.answer as answer,  answer.value = family;
    // sender.dataenterer.practitioner.givenName
    name.given as given -&gt;  item.item as item,  item.linkId = 'sender.dataenterer.practitioner.givenName',  item.answer as answer,  answer.value = given;
  };
  // sender.dataenterer.practitioner.phone
  practitioner.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'sender.dataenterer.practitioner.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
  // sender.dataenterer.practitioner.email
  practitioner.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'sender.dataenterer.practitioner.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
}

group ReceiverCopyToQr(source bundle : Bundle, source composition : Composition, source serviceRequest : ServiceRequest, target item : BackboneElement) {
  composition.extension as extension where (url = 'http://fhir.ch/ig/ch-orf/StructureDefinition/ch-orf-copyreceiver') then {
    extension.value as value then {
      bundle.entry as entry then {
        entry.fullUrl where ($this in %value.reference) and $this.startsWith('urn:uuid') then {
          entry.resource : Organization as organization then ReceiverCopyOrganizationToQr(bundle, composition, organization, item) &quot;organization&quot;;
          entry.resource : Patient as patient then ReceiverCopyPatientToQr(bundle, composition, patient, item) &quot;patient&quot;;
        } &quot;fullUrlAsUuid&quot;;
        entry.resource : Organization as organization where ('Organization' + '/' + $this.id) in %value.reference then ReceiverCopyOrganizationToQr(bundle, composition, organization, item) &quot;organization&quot;;
        entry.resource : Patient as patient where ('Patient' + '/' + $this.id) in %value.reference then ReceiverCopyPatientToQr(bundle, composition, patient, item) &quot;patient&quot;;
      };
    };
  };
}

group ReceiverCopyOrganizationToQr(source bundle : Bundle, source composition : Composition, source organization : Organization, target itemsender : BackboneElement) {
  organization -&gt;  itemsender.item as item,  item.linkId = 'receiverCopy' then {
    // receiverCopy.organization.name
    organization.name as name -&gt;  item.item as item,  item.linkId = 'receiverCopy.organization.name',  item.answer as answer,  answer.value = name;
    organization.contact as contact then {
      contact.name as name then {
        // receiverCopy.title
        name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'receiverCopy.title',  item.answer as answer,  answer.value = prefix;
        // receiverCopy.familyName
        name.family as family -&gt;  item.item as item,  item.linkId = 'receiverCopy.familyName',  item.answer as answer,  answer.value = family;
        // receiverCopy.givenName
        name.given as given -&gt;  item.item as item,  item.linkId = 'receiverCopy.givenName',  item.answer as answer,  answer.value = given;
      };
    };
    // receiverCopy.phone
    organization.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'receiverCopy.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
    // receiverCopy.email
    organization.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'receiverCopy.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
    // receiverCopy.organization.streetAddressLine
    organization.address as addr then {
      addr.line first as line1 -&gt;  item.item as item,  item.linkId = 'receiverCopy.streetAddressLine' then {
        addr.line as line -&gt;  item.answer as answer,  answer.value = line;
      } &quot;addrlinefirst&quot;;
      // receiverCopy.postalCode
      addr.postalCode as postalCode -&gt;  item.item as item,  item.linkId = 'receiverCopy.postalCode',  item.answer as answer,  answer.value = postalCode;
      // receiverCopy.city
      addr.city as city -&gt;  item.item as item,  item.linkId = 'receiverCopy.city',  item.answer as answer,  answer.value = city;
      // receiverCopy.country
      addr.country as country -&gt;  item.item as item,  item.linkId = 'receiverCopy.country',  item.answer as answer,  answer.value = country;
    } &quot;addr&quot;;
  } &quot;organization&quot;;
}

group ReceiverCopyPatientToQr(source bundle : Bundle, source composition : Composition, source patient : Patient, target itemsender : BackboneElement) {
  patient -&gt;  itemsender.item as item,  item.linkId = 'receiverCopy' then {
    patient.name as name then {
      // receiverCopy.familyName
      name.family as family -&gt;  item.item as item,  item.linkId = 'receiverCopy.familyName',  item.answer as answer,  answer.value = family;
      // receiverCopy.givenName
      name.given as given -&gt;  item.item as item,  item.linkId = 'receiverCopy.givenName',  item.answer as answer,  answer.value = given;
      // receiverCopy.title
      name.prefix as prefix where (extension.where((url = 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier') and (valueCode = 'AC'))) -&gt;  item.item as item,  item.linkId = 'receiverCopy.title',  item.answer as answer,  answer.value = prefix;
    };
    // receiverCopy.phone
    patient.telecom as telecom where (system = 'phone') -&gt;  item.item as item,  item.linkId = 'receiverCopy.phone',  item.answer as answer,  answer.value = (telecom.value) &quot;phone&quot;;
    // receiverCopy.email
    patient.telecom as telecom where (system = 'email') -&gt;  item.item as item,  item.linkId = 'receiverCopy.email',  item.answer as answer,  answer.value = (telecom.value) &quot;email&quot;;
    // receiverCopy.organization.streetAddressLine
    patient.address as addr then {
      addr.line first as line1 -&gt;  item.item as item,  item.linkId = 'receiverCopy.streetAddressLine' then {
        addr.line as line -&gt;  item.answer as answer,  answer.value = line;
      } &quot;addrlinefirst&quot;;
      // receiverCopy.postalCode
      addr.postalCode as postalCode -&gt;  item.item as item,  item.linkId = 'receiverCopy.postalCode',  item.answer as answer,  answer.value = postalCode;
      // receiverCopy.city
      addr.city as city -&gt;  item.item as item,  item.linkId = 'receiverCopy.city',  item.answer as answer,  answer.value = city;
      // receiverCopy.country
      addr.country as country -&gt;  item.item as item,  item.linkId = 'receiverCopy.country',  item.answer as answer,  answer.value = country;
    } &quot;addr&quot;;
  } &quot;patient&quot;;
}

group NoteToQr(source serviceRequest : ServiceRequest, target item : BackboneElement) {
  serviceRequest.note as note then {
    note.text as text -&gt;  item.item as item,  item.linkId = 'note.text',  item.answer as answer,  answer.value = cast(text, 'string');
  };
}

</pre>
      </div>

  <!-- insert notes if present -->
  



</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &#169; 2020+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.hl7.ch/">HL7 Switzerland</a>.  Package ch.fhir.ig.ch-orf#0.10.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Tue, Jun 15, 2021 14:23+0200">2021-06-15</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                

| <a style="color: #81BEF7" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSeT-tq5cutjuiVEedqihlMZ56_4UJsdVH6aTGYHTmO34T1Z4g/viewform?usp=sf_link&amp;entry%2E1353807103=ch.fhir.ig.ch-orf%230.10.0%20/StructureMap-OrfBundleToQr.html&amp;entry%2E247644557=Map%20ORF">Propose a change</a>

          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  


  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

